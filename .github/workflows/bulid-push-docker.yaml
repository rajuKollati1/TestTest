name: Docker Build and Push to dock rk

on:
  #push:
    #branches:
      #- main
  workflow_dispatch: # Allows manual triggering from the GitHub UI

jobs:
  build_and_push:
    # IMPORTANT: Use the labels for your self-hosted Windows runner
    runs-on: [self-hosted, windows] 
    
    # Environment variables for image naming
    env:
      DOCKER_HUB_USERNAME: ${{ secrets.DOCKER_USERNAME }} # Should be 'rajuprudhvi'
      IMAGE_NAME: Alisha
      DOCKER_TAG: ${{ github.sha }} # Unique tag based on commit hash

    steps:
      - name: ‚¨áÔ∏è Checkout Repository
        uses: actions/checkout@v4

      - name: üîë Login to Docker Hub
        uses: docker/login-action@v3
        with:
          # VITAL: Explicitly passes the credentials to the action
          username: ${{ secrets.DOCKER_USERNAME }} 
          password: ${{ secrets.DOCKER_PASSWORD }} # Uses the securely stored PAT
          logout: true 

      - name: üî® Build and Tag Docker Image
        run: |
          docker build `
            --file apps/Medicalshop/Dockerfile `  
            . `
            --tag ${{ env.DOCKER_HUB_USERNAME }}/${{ env.IMAGE_NAME }}:${{ env.DOCKER_TAG }}
          
          docker tag ${{ env.DOCKER_HUB_USERNAME }}/${{ env.IMAGE_NAME }}:${{ env.DOCKER_TAG }} ${{ env.DOCKER_HUB_USERNAME }}/${{ env.IMAGE_NAME }}:latest

      - name: ‚¨ÜÔ∏è Push Images to Docker Hub
        run: |
          # Push both the unique commit SHA tag and the 'latest' tag
          docker push ${{ env.DOCKER_HUB_USERNAME }}/${{ env.IMAGE_NAME }}:${{ env.DOCKER_TAG }}
          docker push ${{ env.DOCKER_HUB_USERNAME }}/${{ env.IMAGE_NAME }}:latest
